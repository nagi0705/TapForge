---
// CTA Section with integrated Trial Form
import { loadTranslation, getLocaleFromPathname, createTranslator } from '../utils/i18n';
import type { Language } from '../lib/i18n';

interface Props {
  lang?: Language;
}

// Get language from props or URL
const { lang } = Astro.props as Props;
const locale = lang || getLocaleFromPathname(Astro.url.pathname);
const translations = await loadTranslation(locale);
const t = createTranslator(translations);
---

<section class="py-20 bg-gradient-to-br from-blue-600 to-purple-700">
  <div class="container mx-auto px-4">
    <div class="text-center text-white">
      <div class="flex items-center justify-center mb-6">
        <img
          src="/images/favicon.png"
          alt="TapForge"
          class="w-16 h-16 rounded-xl shadow-lg mr-4"
        />
        <h2 class="text-3xl md:text-4xl font-bold" id="cta-title">
          {t("cta.title")}
        </h2>
      </div>
      <p class="text-xl mb-12 opacity-90" id="cta-description">
        {t("cta.description")}
      </p>

      <!-- Trial Form Section -->
      <div class="mb-12 max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
          <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-4" id="trial-title">
              {t("trialForm.title")}
            </h2>
            <p class="text-lg text-gray-600 mb-2">
              <span class="text-red-500 font-bold" id="trial-limited"
                >100名限定! 残り<span id="trial-slots">100</span>名</span
              >
              <span id="trial-description"
                >永続的に月額500円でご利用いただけます</span
              >
            </p>
            <p class="text-sm text-gray-500" id="trial-sub-description">
              初期費用無料、月額500円（初月NFCカード1枚含む）、最低3ヶ月契約
            </p>
          </div>

          <!-- Trial Application -->
          <div class="bg-gray-50 rounded-lg p-6">
            <div class="text-center">
              <h3
                class="text-xl font-semibold text-gray-800 mb-4"
                id="trial-form-title"
              >
                早期アクセスに申し込む
              </h3>
              <p class="text-gray-600 mb-6" id="trial-form-description">
                今すぐ早期アクセスに申し込んで、特別価格を永続適用。
              </p>
              <a
                href="#trial"
                class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl inline-flex items-center justify-center min-h-[48px]"
                id="trial-form-button"
              >
                <span
                  class="text-red-500 font-bold mr-2"
                  id="trial-form-limited">100名限定!</span
                >
                <span id="trial-form-button-text">早期アクセスに申し込む</span>
              </a>
            </div>
          </div>
          <!-- Terms and Conditions -->
          <div class="mt-6 text-center">
            <p class="text-xs text-gray-500" id="terms-text">
              <span id="terms-text-start">申し込みにより、</span><a
                href="/terms"
                class="text-blue-600 hover:underline"
                id="terms-link"
                data-link="terms">利用規約</a
              ><span id="terms-and">および</span><a
                href="/privacy"
                class="text-blue-600 hover:underline"
                id="privacy-link"
                data-link="privacy">プライバシーポリシー</a
              ><span id="terms-text-end">に同意したものとみなされます。</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Trust Indicators -->
      <div
        class="mt-12 flex flex-wrap justify-center gap-8 text-sm opacity-80"
        id="cta-features"
      >
        <div class="flex items-center">
          <svg
            class="w-5 h-5 text-green-400 mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"></path>
          </svg>
          <span id="cta-feature-1">アプリ不要</span>
        </div>
        <div class="flex items-center">
          <svg
            class="w-5 h-5 text-green-400 mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"></path>
          </svg>
          <span id="cta-feature-2">月額500円～</span>
        </div>
        <div class="flex items-center">
          <svg
            class="w-5 h-5 text-green-400 mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"></path>
          </svg>
          <span id="cta-feature-3">4言語対応</span>
        </div>
        <div class="flex items-center">
          <svg
            class="w-5 h-5 text-green-400 mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"></path>
          </svg>
          <span id="cta-feature-4">AI名刺撮影</span>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Keep smooth scrolling functionality
  document.addEventListener("DOMContentLoaded", function () {
    // Update trial slots counter
    const totalSlots = 100;
    const usedSlots = Math.floor(Math.random() * 30); // Simulate 0-30 slots taken
    const remainingSlots = totalSlots - usedSlots;

    const slotElement = document.getElementById("trial-slots");
    if (slotElement) {
      slotElement.textContent = remainingSlots.toString();

      // Add urgency styling if slots are running low
      if (remainingSlots < 20) {
        slotElement.parentElement?.classList.add("animate-pulse");
      }
    }

    // Smooth scrolling for trial links
    document.querySelectorAll('a[href="#trial"]').forEach((link) => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const trialSection = document.getElementById("trial");
        if (trialSection) {
          trialSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    });

    // Track trial form clicks
    const trialButtons = document.querySelectorAll('a[href="#trial"]');
    trialButtons.forEach((button) => {
      button.addEventListener("click", function () {
        if (typeof window !== "undefined" && (window as any).gtag) {
          (window as any).gtag("event", "trial_form_click", {
            event_category: "trial_form",
            event_label: "trial_form_clicked",
          });
        }
      });
    });
  });
</script>
