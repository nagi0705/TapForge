---
import TwSizeIndicator from "@/components/TwSizeIndicator.astro";
import { plainify } from "@/lib/utils/textConverter";
import Footer from "@/partials/Footer.astro";
import Header from "@/partials/Header.astro";
import "@/styles/main.css";
import { ClientRouter } from "astro:transitions";

// TapForge configuration
const siteConfig = {
  title: "TapForge - NFCデジタル名刺で世界と繋がる",
  description:
    "TapForge: アプリ不要、AIで名刺をデジタル化。月額無料で世界と繋がる次世代名刺。フリーランサーの海外案件獲得を支援。",
  base_url: "https://tapforge.cor-jp.com",
  favicon: "/images/favicon.ico",
  author: "Cor.株式会社",
};

// types for frontmatters
export interface Props {
  title?: string;
  meta_title?: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  canonical?: string;
  lang?: "ja" | "en" | "zh" | "es";
}

// distructure frontmatters
const {
  title,
  meta_title,
  description,
  image,
  noindex,
  canonical,
  lang = "ja",
} = Astro.props;
---

<!doctype html>
<html lang={lang}>
  <head>
    <!-- favicon -->
    <link rel="shortcut icon" href={siteConfig.favicon} />
    <!-- theme meta -->
    <meta name="theme-name" content="tapforge" />
    <meta name="msapplication-TileColor" content="#3B82F6" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: light)"
      content="#3B82F6"
    />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#1E40AF"
    />
    <meta name="generator" content={Astro.generator} />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!-- Google Fonts - Noto Sans JP for Japanese -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- responsive meta -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=5"
    />

    <!-- title -->
    <title>
      {plainify(meta_title ? meta_title : title ? title : siteConfig.title)}
    </title>

    <!-- canonical url -->
    {canonical && <link rel="canonical" href={canonical} item-prop="url" />}

    <!-- noindex robots -->
    {noindex && <meta name="robots" content="noindex,nofollow" />}

    <!-- meta-description -->
    <meta
      name="description"
      content={plainify(description ? description : siteConfig.description)}
    />

    <!-- SEO Keywords -->
    <meta
      name="keywords"
      content="TapForge,NFCデジタル名刺,AI名刺管理,多言語名刺,ペーパーレス名刺,フリーランス向けデジタル名刺,アプリ不要名刺,デジタル名刺,NFC名刺,AI名刺,ビジネス名刺,海外案件,フリーランス支援"
    />

    <ClientRouter />

    <!-- author -->
    <meta name="author" content={siteConfig.author} />

    <!-- og-title -->
    <meta
      property="og:title"
      content={plainify(
        meta_title ? meta_title : title ? title : siteConfig.title,
      )}
    />

    <!-- og-description -->
    <meta
      property="og:description"
      content={plainify(description ? description : siteConfig.description)}
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content={`${siteConfig.base_url}/${Astro.url.pathname.replace("/", "")}`}
    />

    <!-- twitter-title -->
    <meta
      name="twitter:title"
      content={plainify(
        meta_title ? meta_title : title ? title : siteConfig.title,
      )}
    />

    <!-- twitter-description -->
    <meta
      name="twitter:description"
      content={plainify(description ? description : siteConfig.description)}
    />

    <!-- og-image -->
    <meta
      property="og:image"
      content={`${siteConfig.base_url}${image ? image : "/images/favicon.ico"}`}
    />

    <!-- twitter-image -->
    <meta
      name="twitter:image"
      content={`${siteConfig.base_url}${image ? image : "/images/favicon.ico"}`}
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@TapForge" />
    <meta name="twitter:creator" content="@CorJP" />

    <!-- Google Analytics 4 (placeholder) -->
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script> -->

    <!-- Hotjar (placeholder) -->
    <!-- <script>(function(h,o,t,j,a,r){h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};h._hjSettings={hjid:YOUR_HOTJAR_ID,hjsv:6};a=o.getElementsByTagName('head')[0];r=o.createElement('script');r.async=1;r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;a.appendChild(r)})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');</script> -->

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "TapForge",
      "description": "AI駆動の次世代NFCデジタル名刺。アプリ不要、月額無料で世界と繋がる。フリーランサーの海外案件獲得を支援。",
      "url": "https://tapforge.cor-jp.com",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "JPY",
        "description": "月額無料プラン"
      },
      "provider": {
        "@type": "Organization",
        "name": "Cor.株式会社",
        "url": "https://cor-jp.com"
      },
      "featureList": [
        "NFCタップで名刺交換",
        "AI駆動の名刺管理",
        "多言語対応（日本語、英語、中国語、スペイン語）",
        "アプリ不要",
        "月額無料",
        "フリーランス支援"
      ],
      "screenshot": "https://tapforge.cor-jp.com/images/hero-demo.png"
    }
    </script>
  </head>
  <body>
    <TwSizeIndicator />
    <Header />
    <main id="main-content" class="min-h-[60vh]">
      <slot />
    </main>
    <Footer lang={lang as "ja" | "en" | "zh" | "es"} />
  </body>
</html>
